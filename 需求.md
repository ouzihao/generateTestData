我们正在构建一个综合造数平台，主要功能包括根据数据库表结构生成大量自定义规则的数据，并将数据插入数据库或导出为SQL文件。同时，平台还需支持生成复杂JSON结构的压测数据。以下是根据需求整理的项目开发需求文档。
综合造数平台需求文档
1. 项目概述
构建一个支持自定义数据生成规则的综合造数平台，主要功能包括：
- 根据数据库表结构生成数据，支持自定义字段生成规则，数据可插入数据库或导出为SQL文件。
- 生成复杂JSON结构的压测数据，支持嵌套数组和对象，每个字段可独立配置生成规则。
- 支持批量生成数据时的重复性约束（指定字段不允许重复）和数量配置。
2. 功能需求
2.1 数据库表结构数据生成
- ​表结构解析​：支持从数据库（MySQL、PostgreSQL等）读取表结构，包括字段名、类型、约束等。
- ​字段规则配置​：为每个字段配置数据生成规则，规则类型包括：
- 固定值
- 自增序列（如从17000001开始，连续或步长递增）
- 随机值（数字、字符串、日期等）
- 范围随机值（如数字范围、日期范围）
- 正则表达式生成（如生成符合正则的字符串）
- 枚举值（从预设列表中随机选择）
- 引用其他字段（如根据字段A生成字段B）
- 自定义函数（通过JavaScript等脚本自定义生成逻辑）
- ​数据生成​：
- 支持生成指定数量的数据（如1000万条）。
- 支持指定哪些字段不允许重复（如唯一索引字段）。
- ​输出方式​：
- 直接插入目标数据库（支持MySQL、PostgreSQL等）。
- 导出为SQL文件（包含INSERT语句）。
2.2 JSON压测数据生成
- ​JSON结构定义​：支持用户通过UI定义JSON结构，包括对象、数组、基本类型等。
- ​字段规则配置​：为JSON中的每个字段（包括嵌套对象和数组中的字段）配置生成规则，规则类型同数据库字段规则（固定值、随机值、正则、自增等）。
- ​数组配置​：
- 支持配置数组长度（固定值或随机范围）。
- 数组元素为对象时，可单独配置每个字段的生成规则。
- ​数据生成​：
- 生成指定数量的JSON对象（如生成1000个符合结构的JSON对象）。
- 支持指定哪些字段不允许重复（如ID字段）。
- ​输出方式​：导出为JSON文件（每行一个JSON对象或整个数组）。
2.3 通用功能
- ​任务管理​：创建、保存、执行数据生成任务，查看任务历史。
- ​批量生成配置​：
- 设置生成数据的总量。
- 设置不允许重复的字段（支持多个字段组合唯一）。
- ​性能要求​：支持高效生成大量数据（如1000万条），需考虑内存和性能优化（如分批生成、写入）。
3. 技术方案
3.1 技术栈
- ​后端​：Go (Gin框架)
- ​前端​：Vue3 + Element Plus
- ​数据库​：使用SQLite或MySQL存储平台自身的配置数据（如任务配置、规则模板等）
3.2 后端模块设计
1.​数据库连接模块​：
- 支持连接多种数据库（MySQL、PostgreSQL），用于读取表结构和插入数据。
- 使用ORM或原生SQL驱动（如github.com/go-sql-driver/mysql, github.com/lib/pq）。
2.​规则引擎模块​：
- 实现各种数据生成规则（自增、随机、正则等）。
- 支持自定义脚本（如通过Go的otto库执行JavaScript）。
3.​数据生成核心模块​：
- 根据配置生成单条数据（数据库行或JSON对象）。
- 批量生成时，处理重复性约束（如使用内存映射或临时数据库确保唯一性）。
- 分批生成数据以避免内存溢出（如每1万条写入一次数据库或文件）。
4.​任务调度模块​：
- 异步执行数据生成任务（使用Goroutine和Channel管理并发）。
- 任务状态持久化（保存到平台数据库）。
5.​文件导出模块​：
- 生成SQL文件（格式化为INSERT语句）。
- 生成JSON文件（支持行分隔或数组格式）。
6.​API接口（Gin路由）​​：
- 数据库表结构读取接口
- 规则配置保存/读取接口
- 数据生成任务触发接口
- 任务状态查询接口
- 文件导出接口
3.3 前端功能设计
1.​数据源管理​：配置数据库连接（用于读取表结构）。
2.​数据库造数任务配置​：
- 选择表，展示字段列表，为每个字段配置生成规则。
- 设置生成数量、重复性约束、输出方式（插入数据库或导出SQL文件）。
3.​JSON造数任务配置​：
- JSON结构编辑器（树形结构或代码编辑器）。
- 为每个字段配置生成规则，设置数组长度。
- 设置生成数量、重复性约束。
4.​任务管理​：任务列表、执行状态查看、历史记录、导出文件下载。
4. 关键实现细节
4.1 数据库数据生成流程
sequenceDiagram
    participant User as 用户
    participant Frontend as 前端
    participant Backend as 后端
    participant DB as 目标数据库

    User->>Frontend: 配置数据库连接和表
    Frontend->>Backend: 请求表结构
    Backend->>DB: 读取表结构
    DB-->>Backend: 返回字段列表
    Backend-->>Frontend: 返回字段列表
    User->>Frontend: 为字段配置规则，设置生成数量
    Frontend->>Backend: 提交生成任务
    Backend->>Backend: 启动异步任务
    Backend-->>Frontend: 返回任务ID
    loop 分批生成
        Backend->>Backend: 根据规则生成一批数据（如1万条）
        Backend->>DB: 插入数据（或生成SQL）
        Backend->>Backend: 更新任务进度
    end
    Backend->>Backend: 生成SQL文件（如果选择导出）
    Backend-->>Frontend: 任务完成通知
4.2 JSON数据生成流程
- 解析用户定义的JSON结构（递归处理嵌套对象和数组）。
- 为每个叶子节点（基本类型字段）配置生成规则。
- 生成数据时，从根节点开始递归生成，处理数组时根据配置的长度生成多个元素。
4.3 重复性约束实现
- 对于不允许重复的字段，在批量生成时需确保唯一性。
- 实现方案：
- 使用内存中的Map记录已生成的值（适用于数据量不大时）。
- 对于海量数据（如1000万条），使用本地磁盘的KV存储（如BadgerDB）或布隆过滤器（存在误判）辅助去重。
5. 非功能需求
- ​性能​：生成1000万条数据应在合理时间内完成（如10分钟内）。
- ​可扩展性​：支持插件式扩展新的数据生成规则。
- ​易用性​：提供友好的UI界面，减少配置复杂度。
6. 后续扩展
- 支持从Excel导入生成规则。
- 支持更复杂的数据关联（如生成的数据跨表关联）。
- 支持数据脱敏规则。
7. 输出文档
- 本需求文档（Markdown格式）。
- API接口文档（使用Swagger）。
- 数据库设计文档（平台自身的数据表结构）。
